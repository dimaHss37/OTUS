```sh
lsblk
NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
loop0    7:0    0  73,9M  1 loop /snap/core22/2133
loop1    7:1    0  11,1M  1 loop /snap/firmware-updater/167
loop2    7:2    0 247,6M  1 loop /snap/firefox/6966
loop3    7:3    0  11,8M  1 loop /snap/desktop-security-center/59
loop4    7:4    0  91,7M  1 loop /snap/gtk-common-themes/1535
loop5    7:5    0  50,8M  1 loop /snap/snapd/25202
loop6    7:6    0     4K  1 loop /snap/bare/5
loop7    7:7    0 516,2M  1 loop /snap/gnome-42-2204/226
loop8    7:8    0  14,4M  1 loop /snap/prompting-client/104
loop9    7:9    0   576K  1 loop /snap/snapd-desktop-integration/315
loop10   7:10   0  17,5M  1 loop /snap/snap-store/1300
sr0     11:0    1   5,3G  0 rom  /media/dima/Ubuntu 25.10 amd64
vda    253:0    0    10G  0 disk
vdb    253:16   0    20G  0 disk
├─vdb1 253:17   0     1M  0 part
├─vdb2 253:18   0   1,9G  0 part [SWAP]
└─vdb3 253:19   0  18,1G  0 part /
```

* Будем работать с диском vda

* Создадим PV:
```sh
pvcreate /dev/vda
  Physical volume "/dev/vda" successfully created.
```

```sh
pvs
  PV         VG Fmt  Attr PSize  PFree
  /dev/vda      lvm2 ---  10,00g 10,00g
```

* Создадим VG:
```sh
vgcreate super_system /dev/vda
  Volume group "super_system" successfully created
```

```sh
vgs
  VG           #PV #LV #SN Attr   VSize   VFree
  super_system   1   0   0 wz--n- <10,00g <10,00g
```

* Создадим LV:
```sh
lvcreate -L 8G -n test_1 super_system
  Logical volume "test_1" created.
```

```sh
lvs
  LV     VG           Attr       LSize Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  test_1 super_system -wi-a----- 8,00g
```

* Информация о созданной группе:
```sh
vgdisplay super_system
  --- Volume group ---
  VG Name               super_system
  System ID
  Format                lvm2
  Metadata Areas        1
  Metadata Sequence No  2
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                1
  Open LV               0
  Max PV                0
  Cur PV                1
  Act PV                1
  VG Size               <10,00 GiB
  PE Size               4,00 MiB
  Total PE              2559
  Alloc PE / Size       2048 / 8,00 GiB
  Free  PE / Size       511 / <2,00 GiB
  VG UUID               YUoUxG-iKIR-GaIc-6hb3-Anav-0OVI-f3qOWc
```

* Информация о LV:
```sh
lvdisplay /dev/super_system/test_1
  --- Logical volume ---
  LV Path                /dev/super_system/test_1
  LV Name                test_1
  VG Name                super_system
  LV UUID                2krwxw-QEwB-CxQr-KvRx-S63D-6y1j-lisfFb
  LV Write Access        read/write
  LV Creation host, time OTUS, 2025-11-11 21:33:38 +0300
  LV Status              available
  # open                 0
  LV Size                8,00 GiB
  Current LE             2048
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     16384
  Block device           252:0
```

* Создадим ещё один LV:
```sh
lvcreate -L100M -n test_2 super_system
  Logical volume "test_2" created.
```

```sh
lvs
  LV     VG           Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  test_1 super_system -wi-a-----   8,00g
  test_2 super_system -wi-a----- 100,00m
```

* Создадим на LV файловую систему и смонтируем его:
```sh
mkfs.ext4 /dev/super_system/test_1
mke2fs 1.47.2 (1-Jan-2025)
Discarding device blocks: готово
Creating filesystem with 2097152 4k blocks and 524288 inodes
UUID файловой системы: 6290e324-a46f-4003-98c2-cd4c8818f933
Superblock backups stored on blocks:
	32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632

Распределение групповых таблиц: готово
Сохранение таблицы inod'ов: готово
Создание журнала (16384 блоков): готово
Writing superblocks and filesystem accounting information: готово
```

```sh
mkdir /data
mount /dev/super_system/test_1 /data/
mount | grep /data
/dev/mapper/super_system-test_1 on /data type ext4 (rw,relatime)
```

* Расширение LVM

Расширим файловую систему на /dev/super_system/test_1 за счет нового блочного устройства dev/vdc:

```sh
pvcreate /dev/vdc
  Physical volume "/dev/vdc" successfully created.
  ```


```sh
  pvs
  PV         VG           Fmt  Attr PSize   PFree
  /dev/vda   super_system lvm2 a--  <10,00g <1,90g
  /dev/vdc                lvm2 ---    2,00g  2,00g
```

Расширяем VG добавляя новый диск:

```sh
vgextend super_system /dev/vdc
  Volume group "super_system" successfully extended
```

Проверяем что диск добавлен в группу:

```sh
vgdisplay -v super_system | grep 'PV Name'
  PV Name               /dev/vda
  PV Name               /dev/vdc
```

Смотрим место в VG:

```sh
vgs
  VG           #PV #LV #SN Attr   VSize  VFree
  super_system   2   2   0 wz--n- 11,99g 3,89g
```


* Занимаем все свободное место:

```sh
dd if=/dev/zero of=/data/test_1.log bs=1M count=8000 status=progress
8313110528 bytes (8.3 GB, 7.7 GiB) copied, 105.017 s, 79 MB/sdd: IO error: No space left on device
```

```sh
df -h /data/
Файл.система                    Размер Использовано  Дост Использовано% Cмонтировано в
/dev/mapper/super_system-test_1   7,8G         7,8G     0          100% /data
```

* Увеличиваем LV:

```sh
lvextend -l+80%FREE /dev/super_system/test_
  Size of logical volume super_system/test_1 changed from 8,00 GiB (2048 extents) to <11,12 GiB (2846 extents).
  Logical volume super_system/test_1 successfully resized.
```

```sh
lvs /dev/super_system/test_1
  LV     VG           Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  test_1 super_system -wi-ao---- <11,12g
```

* Resize файловой системы:

```sh
resize2fs /dev/s
sg0           snapshot      sr0           stdin         super_system/
shm/          snd/          stderr        stdout
root@OTUS:~# resize2fs /dev/s
sg0           snapshot      sr0           stdin         super_system/
shm/          snd/          stderr        stdout
root@OTUS:~# resize2fs /dev/super_system/test_1
resize2fs 1.47.2 (1-Jan-2025)
Файловая система по адресу /dev/super_system/test_1 подключена к /data; требуется оперативное изменение размера
old_desc_blocks = 1, new_desc_blocks = 2
Файловая система на /dev/super_system/test_1 теперь длинной 2914304 (4k) блоков.
```

```sh
df -h /data/
Файл.система                    Размер Использовано  Дост Использовано% Cмонтировано в
/dev/mapper/super_system-test_1    11G         7,8G  2,6G           76% /data
```

* Работа со снапшотами

Создадим снапшот:
```sh
lvcreate -L 500M -s -n test_snap_1 /dev/super_system/test_1
  Logical volume "test_snap_1" created.
```

Проверяем:
```sh
vgs -o +lv_size,lv_name | grep test
  super_system   2   3   1 wz--n- 11,99g 296,00m <11,12g test_1
  super_system   2   3   1 wz--n- 11,99g 296,00m 100,00m test_2
  super_system   2   3   1 wz--n- 11,99g 296,00m 500,00m test_snap_1
```

```sh
lsblk
NAME                           MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
vda                            253:0    0    10G  0 disk
├─super_system-test_2          252:1    0   100M  0 lvm
└─super_system-test_1-real     252:2    0  11,1G  0 lvm
  ├─super_system-test_1        252:0    0  11,1G  0 lvm
  └─super_system-test_snap_1   252:4    0  11,1G  0 lvm
vdb                            253:16   0    20G  0 disk
├─vdb1                         253:17   0     1M  0 part
├─vdb2                         253:18   0   1,9G  0 part [SWAP]
└─vdb3                         253:19   0  18,1G  0 part /
vdc                            253:32   0     2G  0 disk
├─super_system-test_1-real     252:2    0  11,1G  0 lvm
│ ├─super_system-test_1        252:0    0  11,1G  0 lvm
│ └─super_system-test_snap_1   252:4    0  11,1G  0 lvm
└─super_system-test_snap_1-cow 252:3    0   500M  0 lvm
  └─super_system-test_snap_1   252:4    0  11,1G  0 lvm
vdd                            253:48   0     1G  0 disk
vde                            253:64   0     1G  0 disk
```

* Монтирование снапшота:
```sh
mkdir /data_snap

mount /dev/super_system/test_snap_1 /data_snap/

ll /data_snap/
total 8135708
drwxr-xr-x  3 root root       4096 Nov 12 19:12 ./
drwxr-xr-x 22 root root       4096 Nov 16 10:06 ../
drwx------  2 root root      16384 Nov 11 22:14 lost+found/
-rw-r--r--  1 root root 8330936320 Nov 12 19:14 test_1.log

umount /data_snap
```
* Откат:
Удалим log  файл для наглядности:
```sh
rm /data/test_1.log

ls -l /data
total 16
drwx------ 2 root root 16384 Nov 11 22:14 lost+found

umount /data
```

```sh
lvconvert --merge /dev/super_system/test_snap_1
  Merging of volume super_system/test_snap_1 started.
  super_system/test_1: Merged: 99,92%
  super_system/test_1: Merged: 100,00%
```

```sh
mount /dev/super_system/test_1 /data

ls -l /data
total 8135700
drwx------ 2 root root      16384 Nov 11 22:14 lost+found
-rw-r--r-- 1 root root 8330936320 Nov 12 19:14 test_1.log
```
* Работа с LVM-RAID:
```sh
pvcreate /dev/vd{d,e}
  Physical volume "/dev/vdd" successfully created.
  Physical volume "/dev/vde" successfully created.
```

```sh
vgcreate raid_vg /dev/vd{d,e}
  Volume group "raid_vg" successfully created
  
  vgs
  VG           #PV #LV #SN Attr   VSize  VFree
  raid_vg        2   0   0 wz--n-  1,99g   1,99g
  super_system   2   2   0 wz--n- 11,99g 796,00m
```

```sh
lvcreate -l+90%FREE -m1 -n mirror_1 raid_vg
  Logical volume "mirror_1" created.
```

```sh
lvs
  LV       VG           Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  mirror_1 raid_vg      rwi-a-r--- 916,00m                                    100,00
  test_1   super_system -wi-ao---- <11,12g
  test_2   super_system -wi-a----- 100,00m
```